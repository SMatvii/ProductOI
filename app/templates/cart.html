{% extends "base.html" %}

{% block title %}ProductOI - Cart{% endblock %}

{% block content %}
<h1 style="color: #7c3aed; margin-bottom: 2rem;">Your Cart</h1>

{% if cart %}
<div class="cart-container">
    <div class="cart-items">
        {% for item in cart %}
        <div class="cart-item">
            <div style="display:flex; align-items:center; gap:1rem;">
                {% if item.image %}
                    {% if item.image.startswith('http') %}
                        <img src="{{ item.image }}" alt="{{ item.name }}" class="order-thumb">
                    {% else %}
                        <img src="{{ url_for('static', filename='images/' ~ item.image) }}" alt="{{ item.name }}" class="order-thumb">
                    {% endif %}
                {% else %}
                    {% set name = item.name|lower %}
                    {% if 'pizza' in name %}
                        {% set fallback = 'https://source.unsplash.com/400x300/?pizza' %}
                    {% elif 'burger' in name or '–±—É—Ä–≥–µ—Ä' in name %}
                        {% set fallback = 'https://source.unsplash.com/400x300/?burger' %}
                    {% elif 'pasta' in name or '–ø–∞—Å—Ç–∞' in name or '—Å–ø–∞–≥–µ—Ç' in name %}
                        {% set fallback = 'https://source.unsplash.com/400x300/?pasta' %}
                    {% elif 'salad' in name or '—Å–∞–ª–∞—Ç' in name %}
                        {% set fallback = 'https://source.unsplash.com/400x300/?salad' %}
                    {% elif 'drink' in name or '–Ω–∞–ø—ñ–π' in name or '—Å—ñ–∫' in name %}
                        {% set fallback = 'https://source.unsplash.com/400x300/?drink' %}
                    {% else %}
                        {% set fallback = 'https://source.unsplash.com/400x300/?food' %}
                    {% endif %}
                    <img src="{{ fallback }}" alt="{{ item.name }}" class="order-thumb">
                {% endif %}
                <div class="item-details">
                    <div class="item-name">{{ item.name }}</div>
                    <div class="item-price">{{ item.price }}UAH</div>
                </div>
            </div>
            <div class="item-quantity">
                <input type="number" id="qty-{{ item.id }}" value="{{ item.quantity }}" min="1" 
                    onchange="updateQuantity({{ item.id }})">
                <span style="color: #7c3aed; font-weight: bold;">= {{ item.price * item.quantity }}UAH</span>
                <button class="remove-btn" onclick="removeFromCart({{ item.id }})">Remove</button>
            </div>
        </div>
        {% endfor %}
    </div>

    <div class="cart-summary">
        <h2 style="margin-bottom: 1.5rem;">Order Summary</h2>
        {% set total = 0 %}
        {% for item in cart %}
            {% set total = total + (item.price * item.quantity) %}
        {% endfor %}
        <div class="summary-item">
            <span>Items total:</span>
            <span>{{ total }}UAH</span>
        </div>
        <div class="summary-item">
            <span>Delivery:</span>
            <span>Calculated at checkout</span>
        </div>
        <div class="summary-total">
            <span>TOTAL:</span>
            <span>{{ total }}UAH</span>
        </div>
        <a href="/checkout" class="btn btn-primary" style="margin-top: 2rem;">Checkout</a>
        <a href="/" class="btn btn-secondary" style="margin-top: 1rem;">Continue shopping</a>
    </div>
</div>
{% else %}
<div class="empty-message">
    <h2>Your cart is empty üò¢</h2>
    <p>Add items and find your favorite dishes</p>
    <a href="/" class="btn btn-primary" style="display: inline-block;">Go to catalog</a>
</div>
{% endif %}
{% endblock %}
